<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>11 Redshift Querying Guide – ADRF User Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12-dashboards.html" rel="next">
<link href="./10-packages.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d9110c34616fd975cf68685f99bb278d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 3,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11-querying-guide.html"><span class="chapter-title">11 Redshift Querying Guide</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">ADRF User Guide</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">ADRF User Guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-access.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2 Obtaining ADRF Access</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-onboarding.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 Onboarding Modules and Security Training</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-access-and-use.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 How to Access and Use Your Project Workspace</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-access-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5 How to Access Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-where-to-work.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 Where to Do Your Work</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-collaborate.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 How to Work Collaboratively in the ADRF</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-export.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 How to Export Output from the ADRF</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-dos-and-donts.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 Do’s and Don’ts for Discussing Data Hosted in the ADRF</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-packages.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 Adding Additional Packages in R/Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-querying-guide.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">11 Redshift Querying Guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-dashboards.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 Accessing ADRF Dashboards</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-faq.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">13 Frequently Asked Questions (FAQ)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#topics" id="toc-topics" class="nav-link active" data-scroll-target="#topics">Topics</a></li>
  <li><a href="#data-access" id="toc-data-access" class="nav-link" data-scroll-target="#data-access">Data access</a></li>
  <li><a href="#using-dbeaver-to-access-a-database" id="toc-using-dbeaver-to-access-a-database" class="nav-link" data-scroll-target="#using-dbeaver-to-access-a-database">Using DBeaver to access a database</a>
  <ul class="collapse">
  <li><a href="#creating-tables-in-a-pr-or-tr-schema-in-dbeaver" id="toc-creating-tables-in-a-pr-or-tr-schema-in-dbeaver" class="nav-link" data-scroll-target="#creating-tables-in-a-pr-or-tr-schema-in-dbeaver">Creating tables in a PR or TR schema in Dbeaver</a></li>
  </ul></li>
  <li><a href="#connecting-to-a-database-through-a-statistical-program" id="toc-connecting-to-a-database-through-a-statistical-program" class="nav-link" data-scroll-target="#connecting-to-a-database-through-a-statistical-program">Connecting to a database through a statistical program</a>
  <ul class="collapse">
  <li><a href="#connecting-to-a-database-using-sas" id="toc-connecting-to-a-database-using-sas" class="nav-link" data-scroll-target="#connecting-to-a-database-using-sas">Connecting to a database using SAS</a></li>
  <li><a href="#connecting-to-a-database-using-r" id="toc-connecting-to-a-database-using-r" class="nav-link" data-scroll-target="#connecting-to-a-database-using-r">Connecting to a database using R</a></li>
  <li><a href="#connecting-to-a-database-using-python" id="toc-connecting-to-a-database-using-python" class="nav-link" data-scroll-target="#connecting-to-a-database-using-python">Connecting to a database using Python</a></li>
  <li><a href="#connecting-to-a-database-using-stata" id="toc-connecting-to-a-database-using-stata" class="nav-link" data-scroll-target="#connecting-to-a-database-using-stata">Connecting to a database using Stata</a></li>
  </ul></li>
  <li><a href="#redshift-query-guidelines-for-researchers" id="toc-redshift-query-guidelines-for-researchers" class="nav-link" data-scroll-target="#redshift-query-guidelines-for-researchers">Redshift Query Guidelines for Researchers</a>
  <ul class="collapse">
  <li><a href="#query-tips-and-best-practices" id="toc-query-tips-and-best-practices" class="nav-link" data-scroll-target="#query-tips-and-best-practices">Query Tips and Best Practices</a></li>
  <li><a href="#other-pointers-for-best-database-performance" id="toc-other-pointers-for-best-database-performance" class="nav-link" data-scroll-target="#other-pointers-for-best-database-performance">Other Pointers for best database performance</a></li>
  <li><a href="#amazon-redshift-best-practices-for-from" id="toc-amazon-redshift-best-practices-for-from" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-from">Amazon Redshift best practices for <code>FROM</code></a></li>
  <li><a href="#amazon-redshift-best-practices-for-where" id="toc-amazon-redshift-best-practices-for-where" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-where">Amazon Redshift best practices for WHERE</a></li>
  <li><a href="#amazon-redshift-best-practices-for-group-by" id="toc-amazon-redshift-best-practices-for-group-by" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-group-by">Amazon Redshift best practices for GROUP BY</a></li>
  <li><a href="#amazon-redshift-best-practices-for-having" id="toc-amazon-redshift-best-practices-for-having" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-having">Amazon Redshift best practices for HAVING</a></li>
  <li><a href="#amazon-redshift-best-practices-for-union" id="toc-amazon-redshift-best-practices-for-union" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-union">Amazon Redshift best practices for UNION</a></li>
  <li><a href="#amazon-redshift-best-practices-for-order-by" id="toc-amazon-redshift-best-practices-for-order-by" class="nav-link" data-scroll-target="#amazon-redshift-best-practices-for-order-by">Amazon Redshift best practices for ORDER BY</a></li>
  <li><a href="#troubleshooting-queries" id="toc-troubleshooting-queries" class="nav-link" data-scroll-target="#troubleshooting-queries">Troubleshooting Queries</a></li>
  </ul></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">11 Redshift Querying Guide</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This section provides an introduction to generating proficient Amazon Redshift queries. This is a generalized document meaning you will need to replace “schema_name” and “table_name” with the appropriate schema and table names used for your project.</p>
<p><strong>Note</strong>: All data is stored under schemas in the projects database.</p>
<section id="topics" class="level2">
<h2 class="anchored" data-anchor-id="topics">Topics</h2>
<ul>
<li><a href="#data-access">Data Access</a></li>
<li><a href="#using-dbeaver-to-access-a-database">Using DBeaver to access a database</a>
<ul>
<li><a href="#creating-tables-in-a-pr-or-tr-schema-in-dbeaver">Creating tables in a PR or TR schema in Dbeaver</a></li>
</ul></li>
<li><a href="#connecting-to-a-database-through-a-statistical-program">Connecting to a database through a statistical program</a>
<ul>
<li><a href="#connecting-to-a-database-using-sas">Connecting to a database using SAS</a></li>
<li><a href="#connecting-to-a-database-using-r">Connecting to a database using R</a></li>
<li><a href="#connecting-to-a-database-using-python">Connecting to a database using Python</a></li>
<li><a href="#connecting-to-a-database-using-stata">Connecting to a database using Stata</a></li>
</ul></li>
<li><a href="#redshift-query-guidelines-for-researchers">Redshift Query Guidelines for Researchers</a></li>
</ul>
</section>
<section id="data-access" class="level2">
<h2 class="anchored" data-anchor-id="data-access">Data access</h2>
<p>If you are approved to access data that are stored in a database, the data are housed in Redshift. To access those data, you will have to log in to Redshift within your workspace.</p>
<p>You need to replace the “user.name.project” with your <strong>project workspace username</strong>. The <strong>project workspace username</strong> is your user folder name in the U:/ drive:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ap1.png" class="img-fluid figure-img"></p>
<figcaption>Image of Project-Based User Name</figcaption>
</figure>
</div>
<p><strong>Note</strong>: You will need to enter your specific user name when logging into Redshift. The password needed to access Redshift is the second password entered when logging into the ADRF as shown in the screen below: <img src="images/ap2.png" class="img-fluid" alt="Image of Password Entry"></p>
</section>
<section id="using-dbeaver-to-access-a-database" class="level2">
<h2 class="anchored" data-anchor-id="using-dbeaver-to-access-a-database">Using DBeaver to access a database</h2>
<p>To establish a connection to Redshift in DBeaver, first open DBeaver by clicking on the DBeaver icon located on the ADRF desktop and then double click on the server you wish to connect to. <strong>Note</strong>: All data is stored under schemas in the projects database.</p>
<p>In the example below, we will connect to <strong>Redshift11_projects</strong>. After double clicking on Reshift11_projects, a window will appear asking for your <strong>Username</strong> and <strong>Password</strong>. - In Username, enter <strong>“adrf\”</strong> followed by your <strong>project workspace username</strong> - In Password, enter the password associated with your project workspace username <img src="images/ap3.png" class="img-fluid" alt="Complete the Username and Password fields"></p>
<p>After completing the Username and Password fields, click <strong>OK</strong>. You will now have access to your data stored on the Redshift11_projects server.</p>
<p><strong>Note</strong>: Please make sure to enter <strong>“adrf\”</strong> before your project workspace username in the <strong>Username</strong> field. If you do not enter “adrf", or accidently include a”/” instead of a “\”, you will not be able to connect to Redshift. <strong>If you are having trouble connecting, an incorrect entry in Username is most likely the culprit.</strong></p>
<section id="creating-tables-in-a-pr-or-tr-schema-in-dbeaver" class="level3">
<h3 class="anchored" data-anchor-id="creating-tables-in-a-pr-or-tr-schema-in-dbeaver">Creating tables in a PR or TR schema in Dbeaver</h3>
<p>When users create tables in their PR (Research Project) or TR (Training Project) schema, the table is initially permissioned to the user only. This is analogous to creating a document or file in your U drive: Only you have access to the newly created table.</p>
<p>If you want to allow all individuals in your project workspace to access the table in the PR/TR schema, you will need to grant permission to the table to the rest of the users who have access to the PR or TR schema.</p>
<p>You can do this by running the following code: <code>GRANT SELECT, UPDATE, DELETE, INSERT ON TABLE schema_name.table_name TO group db_xxxxxx_rw;</code></p>
<p><strong>Note</strong>: Note: In the above code example replace schma_name with the pr_ or tr_ schema assigned to your workspace and replace table_name with the name of the table on which you want to grant access. Also, in the group name <code>db_xxxxxx_rw</code>, replace <code>xxxxxx</code> with your project code. This is the last 6 characters in your project based user name. This will start with either a T or a P.</p>
<p>If you want to allow <strong>only a single user</strong> on your project to access the table, you will need to grant permission to that user. You can do this by running the following code:</p>
<p><code>GRANT SELECT, UPDATE, DELETE, INSERT ON TABLE schema_name.table_name to "IAM:first_name.last_name.project_code";</code></p>
<p><strong>Note</strong>: In the above code example replace schma_name with the pr_ or tr_ schema assigned to your workspace and replace table_name with the name of the table on which you want to grant access. Also, in <code>"IAM:first_name.last_name.project_code"</code> update <code>first_name.last_name.project_code</code> with the user name to whom you want to grant access to.</p>
<p>If you have any questions, please reach out to us at <a href="mailto:support@coleridgeinitiative.org">support@coleridgeinitiative.org</a></p>
</section>
</section>
<section id="connecting-to-a-database-through-a-statistical-program" class="level2">
<h2 class="anchored" data-anchor-id="connecting-to-a-database-through-a-statistical-program">Connecting to a database through a statistical program</h2>
<p>When connecting to the database using an ODBC connection, you need to use one of the following DSNs:</p>
<ul>
<li><code>Redshift01_projects_DSN</code></li>
<li><code>Redshift11_projects_DSN</code></li>
</ul>
<p>In the code examples below, the default DSN is <code>Redshift01_projects_DSN</code>.</p>
<p><strong>Topics:</strong> - <a href="#connecting-to-a-database-using-sas">Connecting to a database using SAS</a> - <a href="#connecting-to-a-database-using-r">Connecting to a database using R</a> - <a href="#connecting-to-a-database-using-python">Connecting to a database using Python</a> - <a href="#connecting-to-a-database-using-stata">Connecting to a database using Stata</a></p>
<section id="connecting-to-a-database-using-sas" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-a-database-using-sas">Connecting to a database using SAS</h3>
<p>Use the following code to connect to a databse using SAS:</p>
<pre class="sas"><code>proc sql;
connect to odbc as my con
(datasrc=Redshift01_projects_DSN user=adrf\user.name.project password=password);
select * from connection to mycon
(select * form projects.schema.table);
disconnect from mycon;
quit;</code></pre>
</section>
<section id="connecting-to-a-database-using-r" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-a-database-using-r">Connecting to a database using R</h3>
<ul>
<li><a href="#recommend-method-for-connecting-to-a-database-using-r">Recommended method for connecting to a database using R</a></li>
<li><a href="#using-renviron-file-to-connect-to-a-database-using-r">Using Renviron file to connect to a database using R</a></li>
<li><a href="#best-practices-for-loading-large-amounts-of-data-in-r">Best practices for loading large amounts of data in R</a></li>
</ul>
<section id="recommended-method-for-connecting-to-a-database-using-r" class="level4">
<h4 class="anchored" data-anchor-id="recommended-method-for-connecting-to-a-database-using-r">Recommended method for connecting to a database using R</h4>
<p><strong>Note</strong>: To use this method, you may need to install the packages RJDBC and rstudioapi first.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RJDBC)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create username</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dbusr<span class="ot">=</span><span class="fu">paste</span>(<span class="st">"ADRF</span><span class="sc">\\</span><span class="st">"</span>, <span class="fu">Sys.getenv</span>(<span class="st">"USERNAME"</span>), <span class="at">sep=</span> <span class="st">''</span>)                                                                                </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Database URL</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"jdbc:redshift:iam://adrf-redshift01.cdy8ch2udktk.us-gov-west-1.redshift.amazonaws.com:5439/projects;"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"loginToRp=urn:amazon:webservices:govcloud;"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ssl=true;"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"AutoCreate=true;"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"idp_host=adfs.adrf.net;"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"idp_port=443;"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">"ssl_insecure=true;"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"plugin_name=com.amazon.redshift.plugin.AdfsCredentialsProvider"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Redshift JDBC Driver Setting</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>driver <span class="ot">&lt;-</span> <span class="fu">JDBC</span>(<span class="st">"com.amazon.redshift.jdbc42.Driver"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">classPath =</span> <span class="st">"C:</span><span class="sc">\\</span><span class="st">drivers</span><span class="sc">\\</span><span class="st">redshift_withsdk</span><span class="sc">\\</span><span class="st">redshift-jdbc42-2.1.0.12</span><span class="sc">\\</span><span class="st">redshift-jdbc42-2.1.0.12.jar"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">identifier.quote=</span><span class="st">"`"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(driver, url, dbusr, rstudioapi<span class="sc">::</span><span class="fu">askForPassword</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-renviron-file-to-connect-to-a-database-using-r" class="level4">
<h4 class="anchored" data-anchor-id="using-renviron-file-to-connect-to-a-database-using-r">Using Renviron file to connect to a database using R</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RJDBC)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dbusr<span class="ot">=</span><span class="fu">Sys.getenv</span>(<span class="st">"DBUSER"</span>)                                                                    dbpswd<span class="ot">=</span><span class="fu">Sys.getenv</span>(<span class="st">"DBPASSWD"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Database URL</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"jdbc:redshift:iam://adrf-redshift01.cdy8ch2udktk.us-gov-west-1.redshift.amazonaws.com:5439/projects;"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">"loginToRp=urn:amazon:webservices:govcloud;"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">"ssl=true;"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">"AutoCreate=true;"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">"idp_host=adfs.adrf.net;"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">"idp_port=443;"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">"ssl_insecure=true;"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">"plugin_name=com.amazon.redshift.plugin.AdfsCredentialsProvider"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Redshift JDBC Driver Setting</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>driver <span class="ot">&lt;-</span> <span class="fu">JDBC</span>(<span class="st">"com.amazon.redshift.jdbc42.Driver"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="at">classPath =</span> <span class="st">"C:</span><span class="sc">\\</span><span class="st">drivers</span><span class="sc">\\</span><span class="st">redshift_withsdk</span><span class="sc">\\</span><span class="st">redshift-jdbc42-2.1.0.12</span><span class="sc">\\</span><span class="st">redshift-jdbc42-2.1.0.12.jar"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="at">identifier.quote=</span><span class="st">"`"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(driver, url, dbusr, dbpswd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Note</strong>: For the above code to work, please create a file name .Renviron in your user folder (user folder is something like i.e.&nbsp;<code>u:\John.doe.p00002</code>) And <code>.Renviron</code> file should contain the following:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DBUSER<span class="ot">=</span><span class="st">'adrf\John.doe.p00002'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>DBPASSWD<span class="ot">=</span><span class="st">'xxxxxxxxxxxx'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>_ <strong>Note</strong> replace <code>user id</code> and <code>password</code> with your project workspace specific user id and password.</p>
<p>This will ensure you don’t have your id and password in R code and then you can easily share your R code with others without sharing your ID and password._</p>
</section>
<section id="best-practices-for-loading-large-amounts-of-data-in-r" class="level4">
<h4 class="anchored" data-anchor-id="best-practices-for-loading-large-amounts-of-data-in-r">Best practices for loading large amounts of data in R</h4>
<section id="sql-basics-with-r-programming" class="level5">
<h5 class="anchored" data-anchor-id="sql-basics-with-r-programming">SQL Basics with R Programming</h5>
<p>To ensure R can efficiently manage large amounts of data, please add the following lines of code to your R script before any packages are loaded:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">java.parameters =</span> <span class="fu">c</span>(<span class="st">"-XX:+UseConcMarkSweepGC"</span>, <span class="st">"-Xmx8192m"</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="best-practices-for-writing-tables-to-redshift" class="level5">
<h5 class="anchored" data-anchor-id="best-practices-for-writing-tables-to-redshift">Best practices for writing tables to Redshift</h5>
<p>When writing an R data frame to Redshift use the following code as an example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: replace the table_name with the name of the data frame you wish to write to Redshift</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbWriteTable</span>(<span class="at">conn =</span> conn, <span class="co">#name of the connection </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">name =</span> <span class="st">"schema_name.table_name"</span>, <span class="co">#name of table to save df to </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">value =</span> df_name, <span class="co">#name of df to write to Redshift </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">overwrite =</span> <span class="cn">TRUE</span>) <span class="co">#if you want to overwrite a current table, otherwise FALSE</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>qry <span class="ot">&lt;-</span> <span class="st">"GRANT SELECT ON TABLE schema.table_name TO group &lt;group_name&gt;;"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dbSendUpdate</span>(conn,qry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="connecting-to-a-database-using-python" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-a-database-using-python">Connecting to a database using Python</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyodbc</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>cnxn <span class="op">=</span> pyodbc.<span class="ex">connect</span>(<span class="st">'DSN=Redshift01_projects_DSN; UID=adrf</span><span class="er">\</span><span class="st">user.name.project; PWD=password'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(<span class="st">"SELECT * FROM projects.schema_name.table_name"</span>, cnxn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="connecting-to-a-database-using-stata" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-a-database-using-stata">Connecting to a database using Stata</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">odbc</span> <span class="kw">load</span>, <span class="kw">exec</span>(<span class="st">"select * from PATH_TO_TABLE"</span>) <span class="kw">clear</span> dsn(<span class="st">"Redshift11_projects_DSN"</span>) user(<span class="st">"adrf\user.name.project"</span>) password(<span class="st">"password"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="redshift-query-guidelines-for-researchers" class="level2">
<h2 class="anchored" data-anchor-id="redshift-query-guidelines-for-researchers">Redshift Query Guidelines for Researchers</h2>
<p><em>Developing your query</em>. Here’s an example workflow to follow when developing a query.</p>
<ol type="1">
<li>Study the column and table metadata, which is accessible via the table definition. Each table definition can be displayed by clicking on the [+] next the table name.</li>
<li>To get a feel for a table’s values, <code>SELECT * from</code> the tables you’re working with and LIMIT your results (Keep the LIMIT applied as you refine your columns) or use (e.g., <code>select * from [table name] LIMIT 1000</code>)</li>
<li>Narrow down the columns to the minimal set required to answer your question.</li>
<li>Apply any filters to those columns.</li>
<li>If you need to aggregate data, aggregate a small number of rows</li>
<li>Once you have a query returning the results you need, look for sections of the query to save as a Common Table Expression (CTE) to encapsulate that logic.</li>
</ol>
<section id="query-tips-and-best-practices" class="level3">
<h3 class="anchored" data-anchor-id="query-tips-and-best-practices">Query Tips and Best Practices</h3>
<section id="tip-1-use-select-columns-instead-of-select" class="level4">
<h4 class="anchored" data-anchor-id="tip-1-use-select-columns-instead-of-select">Tip 1: Use <code>SELECT &lt;columns&gt;</code> instead of <code>SELECT *</code></h4>
<p>Specify the columns in the SELECT clause instead of using <code>SELECT *</code>. The unnecessary columns place extra load on the database, which slows down not just the single Amazon Redshift, but the whole system.</p>
<p><strong>Inefficient</strong></p>
<p><code>SELECT * FROM projects.schema_name.table_name</code></p>
<p>This query fetches all the data stored in the table you choose which might not be required for a particular scenario.</p>
<p><strong>Efficient</strong></p>
<p><code>SELECT col_A, col_B, col_C FROM projects.schema_name.table_name</code></p>
</section>
<section id="tip-2-always-fetch-limited-data-and-target-accurate-results" class="level4">
<h4 class="anchored" data-anchor-id="tip-2-always-fetch-limited-data-and-target-accurate-results">Tip 2: Always fetch limited data and target accurate results</h4>
<p>Lesser the data retrieved, the faster the query will run. Rather than applying too many filters on the client-side, filter the data as much as possible at the server. This limits the data being sent on the wire and you’ll be able to see the results much faster. In Amazon Redshift use <code>LIMIT (###)</code> qualifier at the end of the query to limit records.</p>
<p><code>SELECT col_A, col_B, col_C FROM projects.schema_name.table_name WHERE [apply some filter] LIMIT 1000</code></p>
</section>
<section id="tip-3-use-wildcard-characters-wisely" class="level4">
<h4 class="anchored" data-anchor-id="tip-3-use-wildcard-characters-wisely">Tip 3: Use wildcard characters wisely</h4>
<p>Wildcard characters can be either used as a prefix or a suffix. Using leading wildcard (<code>%</code>) in combination with an ending wildcard will search all records for a match anywhere within the selected field.</p>
<p><strong>Inefficient</strong></p>
<p><code>Select col_A, col_B, col_C from projects.schema_name.table_name where col_A like '%BRO%'</code></p>
<p>This query will pull the expected results of <em>Brown Sugar, Brownie, Brown Rice</em> and so on. However, it will also pull unexpected results, such as <em>Country Brown, Lamb with Broth, Cream of Broccoli</em>.</p>
<p><strong>Efficient</strong></p>
<p><code>Select col_A, col_B, col_C from projects.schema_name.table_name where col_B like 'BRO%'.</code></p>
<p>This query will pull only the expected results of <em>Brownie, Brown Rice, Brown Sugar</em> and so on.</p>
</section>
<section id="tip-4-does-my-record-exist" class="level4">
<h4 class="anchored" data-anchor-id="tip-4-does-my-record-exist">Tip 4: Does My record exist?</h4>
<p>Normally, developers use <code>EXISTS()</code> or <code>COUNT()</code> queries for matching a record entry. However, <code>EXISTS()</code> is more efficient as it will exit as soon as finding a matching record; whereas, <code>COUNT()</code> will scan the entire table even if the record is found in the first row.</p>
<p><strong>Efficient</strong></p>
<p><code>select col_A from projects.schema_name.table_name A where exists (select 1 from projects.schema_name.table_name B where A.col_A = B.col_A ) order by col_A;</code></p>
</section>
<section id="tip-5-avoidcorrelated-subqueries" class="level4">
<h4 class="anchored" data-anchor-id="tip-5-avoidcorrelated-subqueries">Tip 5: Avoidcorrelated subqueries</h4>
<p>A correlated subquery depends on the parent or outer query. Since it executes row by row, it decreases the overall speed of the process.</p>
<p><strong>Inefficient</strong></p>
<p><code>SELECT col_A, col_B, (SELECT col_C FROM projects.schema_name.table_name_a WHERE col_C = c.rma LIMIT 1) AS new_name FROM projects.schema_name.table_name_b</code></p>
<p>Here, the problem is that the inner query is run for each row returned by the outer query. Going over the <code>table_name_b</code> table again and again for every row processed by the outer query creates process overhead. Instead, for Amazon Redshift query optimization, use <code>JOIN</code> to solve such problems.</p>
<p><strong>Efficient</strong></p>
<p><code>SELECT col_A, col_B, col_C FROM projects.schema_name.table_name c LEFT JOIN projects.schema_name.table_name co ON c.col_A = co.col_B</code></p>
</section>
<section id="tip-6-avoid-using-amazon-redshift-function-in-the-where-condition" class="level4">
<h4 class="anchored" data-anchor-id="tip-6-avoid-using-amazon-redshift-function-in-the-where-condition">Tip 6: Avoid using Amazon Redshift function in the where condition</h4>
<p>Often developers use functions or methods with their Amazon Redshift queries.</p>
<p><strong>Inefficient</strong></p>
<p><code>SELECT col_A, col_B, col_C FROM projects.schema_name.table_name WHERE RIGHT(birth_date,4) = '1965' and LEFT(birth_date,2) = '07'</code></p>
<p>Note that even if <code>birth_date</code> has an index, the above query changes the <code>WHERE</code> clause in such a way that this index cannot be used anymore.</p>
<p><strong>Efficient</strong></p>
<p><code>SELECT col_A, col_B, col_C FROM projects.schema_name.table_name WHERE birth_date between '711965' and '7311965'</code></p>
</section>
<section id="tip-7-use-where-instead-of-having" class="level4">
<h4 class="anchored" data-anchor-id="tip-7-use-where-instead-of-having">Tip 7: Use WHERE instead of HAVING</h4>
<p><code>HAVING</code> clause filters the rows after all the rows are selected. It is just like a filter. Do not use the <code>HAVING</code> clause for any other purposes. It is useful when performing group bys and aggregations.</p>
</section>
<section id="tip-8-use-temp-tables-when-merging-large-data-sets" class="level4">
<h4 class="anchored" data-anchor-id="tip-8-use-temp-tables-when-merging-large-data-sets">Tip 8: Use temp tables when merging large data sets</h4>
<p>Creating local temp tables will limit the number of records in large table joins and merges. Instead of performing large table joins, one can break out the analysis by performing the analysis in two steps: 1. Create a temp table with limiting criteria to create a smaller / filtered result set. 2. Join the temp table to the second large table to limit the number of records being fetched and to speed up the query.</p>
<p>This is especially useful when there are no indexes on the join columns.</p>
<p><strong>Inefficient</strong></p>
<p><code>SELECT col_A, col_B, sum(col_C) total FROM projects.schema_name.table_name pd INNER JOIN projects.schema_name.table_name st ON pd.col_A=st.col_B WHERE pd.col_C like 'DOG%' GROUP BY pd.col_A, pd.col_B, pd.col_C</code></p>
<p>Note that even if joining column <code>col_A</code> has an index, the <code>col_B</code> column does not. In addition, because the size of some tables can be large, one should limit the size of the join table by first building a smaller filtered <code>#temp</code> table then performing the table joins.</p>
<p><strong>Efficient</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> search_path <span class="op">=</span> schema_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note: This statement sets the default schema/database to projects.schema_name</p>
<p><strong>Step 1</strong>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> TEMP <span class="kw">TABLE</span> temp_table (col_A <span class="dt">varchar</span>(<span class="dv">14</span>), col_B <span class="dt">varchar</span>(<span class="dv">178</span>), col_C <span class="dt">varchar</span>(<span class="dv">4</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 2</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> temp_table <span class="kw">SELECT</span> col_A, col_B, col_C</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name <span class="kw">WHERE</span> col_B <span class="kw">like</span> <span class="st">'CAT%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step 3</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pd.col_A, pd.col_B, pd.col_C, <span class="fu">sum</span>(col_C) <span class="kw">as</span> total <span class="kw">FROM</span> temp_table pd <span class="kw">INNER</span> <span class="kw">JOIN</span> projects.schema_name.table_name st <span class="kw">ON</span> pd.col_A<span class="op">=</span>st.col_B <span class="kw">GROUP</span> <span class="kw">BY</span> pd.col_A, pd.col_B, pd.col_C;</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> temp_table;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note always drop the temp table after the analysis is complete to release data from physical memory.</p>
</section>
</section>
<section id="other-pointers-for-best-database-performance" class="level3">
<h3 class="anchored" data-anchor-id="other-pointers-for-best-database-performance">Other Pointers for best database performance</h3>
<p><strong><code>SELECT</code> columns, not stars</strong>. Specify the columns you’d like to include in the results (though it’s fine to use <code>*</code> when first exploring tables — just remember to LIMIT your results).</p>
<p><strong>Avoid using <code>SELECT DISTINCT</code></strong>. The `SELECT DISTINCT1 command in Amazon Redshift used for fetching unique results and remove duplicate rows in the relation. To achieve this task, it basically groups together related rows and then removes them. GROUP BY operation is a costly operation. To fetch distinct rows and remove duplicate rows, use more attributes in the SELECT operation.</p>
<p>Inner joins vs <code>WHERE</code> clause. Use inner join for merging two or more tables rather than using the <code>WHERE</code> clause. The <code>WHERE</code> clause creates the CROSS join/ CARTESIAN product for merging tables. The CARTESIAN product of two tables takes a lot of time.</p>
<p><code>IN</code> versus <code>EXISTS</code>. The <code>IN</code> operator is costlier than <code>EXISTS</code> in terms of scans especially when the result of the subquery is a large dataset. We should try to use <code>EXISTS</code> rather than using <code>IN</code> for fetching results with a subquery.</p>
<p><strong>Avoid</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A , col_B, col_C</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_A <span class="kw">IN</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> col_B <span class="kw">FROM</span> projects.schema_name.table_name <span class="kw">WHERE</span> col_B <span class="op">=</span> <span class="st">'DOG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Prefer</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A , col_B, col_C</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="kw">EXISTS</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> col_A <span class="kw">FROM</span> projects.schema_name.table_name b <span class="kw">WHERE</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>a.col_A <span class="op">=</span> b.col_B <span class="kw">and</span> b.col_B <span class="op">=</span> <span class="st">'DOG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Query optimizers can change the order of the following list, but this general lifecycle of a Amazon Redshift query is good to keep in mind when writing Amazon Redshift.</p>
<ol type="1">
<li><code>FROM</code> (and <code>JOIN</code>) get(s) the tables referenced in the query.</li>
<li><code>WHERE</code> filters data.</li>
<li><code>GROUP BY</code> aggregates data.</li>
<li><code>HAVING</code> filters out aggregated data that doesn’t meet the criteria.</li>
<li><code>SELECT</code> grabs the columns (then deduplicates rows if <code>DISTINCT</code> is invoked).</li>
<li><code>UNION</code> merges the selected data into a result set.</li>
<li><code>ORDER BY</code> sorts the results.</li>
</ol>
</section>
<section id="amazon-redshift-best-practices-for-from" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-from">Amazon Redshift best practices for <code>FROM</code></h3>
<p>Join tables using the ON keyword. Although it’s possible to “join” two tables using a <code>WHERE</code> clause, use an explicit <code>JOIN</code>. The <code>JOIN</code> + <code>ON</code> syntax distinguishes joins from <code>WHERE</code> clauses intended to filter the results.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> search_path <span class="op">=</span> schema_name; <span class="op">-</span>– this statement sets <span class="kw">the</span> <span class="kw">default</span> <span class="kw">schema</span><span class="op">/</span><span class="kw">database</span> <span class="kw">to</span> projects.schema_name</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A.col_A , B.col_B, B.col_C</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name <span class="kw">as</span> A</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> projects.schema_name.table_name B <span class="kw">ON</span> A.col_A <span class="op">=</span> B.col_B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Alias multiple tables</em>. When querying multiple tables, use aliases, and employ those aliases in your select statement, so the database (and your reader) doesn’t need to parse which column belongs to which table.</p>
<p><strong>Avoid</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> search_path <span class="op">=</span> schema_name; <span class="op">-</span>– this statement sets <span class="kw">the</span> <span class="kw">default</span> <span class="kw">schema</span><span class="op">/</span><span class="kw">database</span> <span class="kw">to</span> projects.schema_name</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A , col_B, col_C</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dbo.table_name <span class="kw">as</span> A</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> dbo.table_name <span class="kw">as</span> B <span class="kw">ON</span> A.col_A <span class="op">=</span> B.col_B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Prefer</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> search_path <span class="op">=</span> schema_name;– this statement sets <span class="kw">the</span> <span class="kw">default</span> <span class="kw">schema</span><span class="op">/</span><span class="kw">database</span> <span class="kw">to</span> projects.schema_name</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> A.col_A , B.col_B, B.col_C</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dbo.table_name <span class="kw">as</span> A</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> dbo.table_name <span class="kw">as</span> B</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>A.col_A <span class="op">=</span> B.col_B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="amazon-redshift-best-practices-for-where" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-where">Amazon Redshift best practices for WHERE</h3>
<p>Filter with <code>WHERE</code> before <code>HAVING</code>. Use a <code>WHERE</code> clause to filter superfluous rows, so you don’t have to compute those values in the first place. Only after removing irrelevant rows, and after aggregating those rows and grouping them, include a HAVING clause to filter out aggregates.</p>
<p>Avoid functions on columns in <code>WHERE</code> clauses. Using a function on a column in a WHERE clause can really slow down your query, as the function prevents the database from using an index to speed up the query. Instead of using the index to skip to the relevant rows, the function on the column forces the database to run the function on each row of the table. The concatenation operator || is also a function, so don’t try to concat strings to filter multiple columns. Prefer multiple conditions instead:</p>
<p><strong>Avoid</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A, col_B, col_C <span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> <span class="fu">concat</span>(col_A, col_B) <span class="op">=</span> <span class="st">'REGULARCOFFEE'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Prefer</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A, col_B, col_C <span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_A <span class="op">=</span><span class="st">'REGULAR'</span> <span class="kw">and</span> col_B <span class="op">=</span> <span class="st">'COFFEE'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="amazon-redshift-best-practices-for-group-by" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-group-by">Amazon Redshift best practices for GROUP BY</h3>
<p>Order multiple groupings by descending cardinality. Where possible, GROUP BY columns in order of descending cardinality. That is, group by columns with more unique values first (like IDs or phone numbers) before grouping by columns with fewer distinct values (like state or gender).</p>
</section>
<section id="amazon-redshift-best-practices-for-having" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-having">Amazon Redshift best practices for HAVING</h3>
<p>Only use <code>HAVING</code> for filtering aggregates. Before <code>HAVING</code>, filter out values using a <code>WHERE</code> clause before aggregating and grouping those values.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A, <span class="fu">sum</span>(col_B) <span class="kw">as</span> total_amt</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_C <span class="op">=</span> <span class="dv">1617</span> <span class="kw">and</span> col_A<span class="op">=</span><span class="st">'key'</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> col_A</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="kw">HAVING</span> <span class="fu">sum</span>(col_D)<span class="op">&gt;</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="amazon-redshift-best-practices-for-union" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-union">Amazon Redshift best practices for UNION</h3>
<p>Prefer <code>UNION ALL</code> to <code>UNION</code>. If duplicates are not an issue, <code>UNION ALL</code> won’t discard them, and since <code>UNION ALL</code> isn’t tasked with removing duplicates, the query will be more efficient.</p>
</section>
<section id="amazon-redshift-best-practices-for-order-by" class="level3">
<h3 class="anchored" data-anchor-id="amazon-redshift-best-practices-for-order-by">Amazon Redshift best practices for ORDER BY</h3>
<p>Avoid sorting where possible, especially in subqueries. If you must sort, make sure your subqueries are not needlessly sorting data.</p>
<p><strong>Avoid</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A, col_B, col_C</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_B <span class="kw">IN</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> col_A <span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_C <span class="op">=</span> <span class="dv">534905</span> <span class="kw">ORDER</span> <span class="kw">BY</span> col_B);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Prefer</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> col_A, col_B, col_C</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_A <span class="kw">IN</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> col_B <span class="kw">FROM</span> projects.schema_name.table_name</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> col_C <span class="op">=</span> <span class="dv">534905</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="troubleshooting-queries" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting-queries">Troubleshooting Queries</h3>
<p>There are several metrics for calculating the cost of the query in terms of storage, time, CPU utilization. However, these metrics require DBA permissions to execute. Follow up with ADRF support to get additional assistance.</p>
<p>Using the <code>SVL_QUERY_SUMMARY</code> view: To analyze query summary information by stream, do the following:</p>
<p><strong>Step 1</strong>: <code>select query, elapsed, substring from svl_qlog order by query desc limit 5;</code></p>
<p><strong>Step 2</strong>: <code>select * from svl_query_summary where query = MyQueryID order by stm, seg, step;</code></p>
<p><em><strong>Execution Plan</strong></em>: Lastly, an execution plan is a detailed step-by-step processing plan used by the optimizer to fetch the rows. It can be enabled in the database using the following procedure:</p>
<ol type="1">
<li>Click on SQL Editor in the menu bar.</li>
<li>Click on Explain Execution Plan.</li>
</ol>
<p>It helps to analyze the major phases in the execution of a query. We can also find out which part of the execution is taking more time and optimize that sub-part. The execution plan shows which tables were accessed, what index scans were performed for fetching the data. If joins are present it shows how these tables were merged. Further, we can see a more detailed analysis view of each sub-operation performed during query execution.</p>
</section>
</section>
<section id="section" class="level1">
<h1></h1>
<p><a href="./10-packages.html">⬅️ Previous: Adding Additional Packages in R/Python</a> | <a href="./index.html">Back to Home</a> | <a href="./12-dashboards.html">Next: Accessing ADRF Dashboards ➡️</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10-packages.html" class="pagination-link" aria-label="10 Adding Additional Packages in R/Python">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">10 Adding Additional Packages in R/Python</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-dashboards.html" class="pagination-link" aria-label="12 Accessing ADRF Dashboards">
        <span class="nav-page-text"><span class="chapter-title">12 Accessing ADRF Dashboards</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>